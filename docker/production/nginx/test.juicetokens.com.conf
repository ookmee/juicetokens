server {
    listen 80;
    server_name test.juicetokens.com;

    # API routes to the app container
    location /api/ {
        proxy_pass http://app:3000/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }

    # Grafana monitoring routes
    location /monitoring/ {
        proxy_pass http://grafana:3000/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }

    # Prometheus metrics routes (optional, can be removed if not needed)
    location /metrics/ {
        proxy_pass http://prometheus:9090/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }

    # Serve static files (enable if you have static content)
    # location /static/ {
    #     alias /var/www/test.juicetokens.com/static/;
    #     expires 1y;
    #     add_header Cache-Control "public, no-transform";
    # }

    # Default route
    location / {
        # Placeholder for a frontend app
        # For now, redirect to the API docs or a static page
        return 302 /api/;
    }
} 